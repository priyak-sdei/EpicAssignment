<div class="patients-container">
  <div class="patients-header">
    <h1>Patient Management</h1>
    <p>Search and view patient records from Epic FHIR resources</p>
  </div>

  <div class="search-section card">
    <form (ngSubmit)="onSearch()" #searchForm="ngForm">
      <div class="search-fields-grid">
        <input type="text" placeholder="Family Name" [(ngModel)]="searchModel.family" name="family" class="search-input" />
        <input type="text" placeholder="Given Name" [(ngModel)]="searchModel.given" name="given" class="search-input" />
        <input type="date" placeholder="Birthdate" [(ngModel)]="searchModel.birthdate" name="birthdate" class="search-input" />
        <select [(ngModel)]="searchModel.gender" name="gender" class="search-input">
          <option value="">Select Gender</option>
          <option value="male">Male</option>
          <option value="female">Female</option>
          <option value="other">Other</option>
          <option value="unknown">Unknown</option>
        </select>
        <input type="text" placeholder="Address" [(ngModel)]="searchModel.address" name="address" class="search-input" />
        <input type="text" placeholder="City" [(ngModel)]="searchModel.city" name="city" class="search-input" />
        <input type="text" placeholder="State" [(ngModel)]="searchModel.state" name="state" class="search-input" />
        <input type="text" placeholder="Postal Code" [(ngModel)]="searchModel.postal" name="postal" class="search-input" />
        <input type="text" placeholder="Telecom (Phone or Email)" [(ngModel)]="searchModel.telecom" name="telecom" class="search-input" />
      </div>
      <button type="submit" class="btn btn-primary">Search</button>
    </form>
  </div>

  <div *ngIf="loading" class="loading">Loading...</div>

  <div *ngIf="!loading && filteredPatients.length > 0" class="patients-grid">
    <div *ngFor="let patient of filteredPatients" class="patient-card card">
      <div class="patient-header">
        <div class="patient-avatar">{{ patient.firstName.charAt(0) }}{{ patient.lastName.charAt(0) }}</div>
        <div class="patient-basic-info">
          <h3>{{ patient.firstName }} {{ patient.lastName }}</h3>
          <p>MRN: {{ patient.patientId }}</p>
        </div>
      </div>

      <div class="patient-details">
        <div class="detail-row"><span>DOB:</span> <span>{{ formatDate(patient.dateOfBirth) }}</span></div>
        <div class="detail-row"><span>Gender:</span> <span>{{ patient.gender }}</span></div>
        <div class="detail-row"><span>Phone:</span> <span>{{ patient.phoneNumber || 'Not provided' }}</span></div>
        <div class="detail-row"><span>Email:</span> <span>{{ patient.emailAddress || 'Not provided' }}</span></div>
        <div class="detail-row" *ngIf="patient.streetAddress">
          <span>Address:</span>
          <span>{{ patient.streetAddress }}, {{ patient.city }}, {{ patient.state }} {{ patient.zipCode }}</span>
        </div>
      </div>

      <div class="patient-actions">
        <button class="btn btn-primary" (click)="viewVitals(patient.patientId)">View Vitals</button>
        <button class="btn btn-secondary">Edit Patient</button>
      </div>
    </div>
  </div>

  <div *ngIf="!loading && filteredPatients.length === 0" class="empty-state">
    <h3>No patients found</h3>
    <p>Try adjusting your search criteria or add a new patient.</p>
  </div>
</div>
